## ğŸ¥ ì‹¤ì‹œê°„ ë°©ì†¡(WebRTC)ì„ í™œìš©í•œ ì˜¨ë¼ì¸ ê²½ë§¤ í”Œë«í¼
**BIDCAST**ëŠ” ëˆ„êµ¬ë‚˜ ê²½ë§¤ë¥¼ ê°œì„¤í•˜ê³  ì…ì°°ì— ì°¸ì—¬í•  ìˆ˜ ìˆëŠ” ì‹¤ì‹œê°„ ì˜ìƒ ê¸°ë°˜ ê²½ë§¤ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.  
ì‹¤ì‹œê°„ ì±„íŒ…, ì˜ìƒ ê³µìœ , ì…ì°° ê¸°ëŠ¥ì„ í†µí•´ ìƒë™ê° ìˆëŠ” ê²½ë§¤ ê²½í—˜ì„ ì œê³µí•©ë‹ˆë‹¤.

ğŸ”— [BIDCAST ì„œë²„ GitHub](https://github.com/KR-HS/BidCast_Server)
ğŸ”— [BIDCAST í´ë¼ì´ì–¸íŠ¸ GitHub](https://github.com/KR-HS/BidCast) 
ğŸ”— [AWSì„¸íŒ…í•˜ê¸°](AWSì„¸íŒ….md) 
ğŸŒ [BIDCAST í™ˆí˜ì´ì§€](https://bidcast.kro.kr)

---

### ğŸ”§ ì£¼ìš” ê¸°ëŠ¥
- **ê²½ë§¤ íƒìƒ‰**: ê²½ë§¤ ì¼ì •ê³¼ ê²€ìƒ‰ ê¸°ëŠ¥ì„ í†µí•´ ì›í•˜ëŠ” ê²½ë§¤ë¥¼ ì†ì‰½ê²Œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **ê´€ì‹¬ ê²½ë§¤ ë“±ë¡**: ë§ˆì´í˜ì´ì§€ì—ì„œ ê´€ì‹¬ ê²½ë§¤ë¡œ ë°”ë¡œ ì´ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **ê²½ë§¤ ê°œì„¤**: ëˆ„êµ¬ë‚˜ ê²½ë§¤ì‚¬ê°€ ë˜ì–´ ê²½ë§¤ë¥¼ ê°œì„¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **ê²½ë§¤ ì§„í–‰ ê¸°ëŠ¥**:
  - ê²½ë§¤ì‚¬ëŠ” ì‹¤ì‹œê°„ ë°©ì†¡ì„ í†µí•´ ì…ì°°ì„ ì§„í–‰í•˜ê³ , ë¬¼í’ˆì„ ë‚™ì°°/ìœ ì°° ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  - ê²½ë§¤ ë‹¨ìœ„ ì¡°ì • ë° ì…ì°° ì¢…ë£Œ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.
- **ì…ì°°ì ê¸°ëŠ¥**:
  - ì‹¤ì‹œê°„ ì…ì°°, ë‚™ì°°/ìœ ì°° ê²°ê³¼ë¥¼ ëª¨ë‹¬ ë° ì˜ìƒì„ í†µí•´ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
  - ì‹¤ì‹œê°„ ì±„íŒ…ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ì˜€ìŠµë‹ˆë‹¤. (ìµœê·¼ 40ê°œ ë©”ì‹œì§€ ìœ ì§€)
- **ë§ˆì´í˜ì´ì§€**:
  - ê²½ë§¤ ì´ë ¥, ë‚™ì°° ë‚´ì—­, ë“±ë¡ ìƒí’ˆ ìƒíƒœ ë“±ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---
### ğŸ“¦ í”„ë¡œì íŠ¸ êµ¬ì„± ë° ë°°í¬
- **Vite ê¸°ë°˜ ë©€í‹° í˜ì´ì§€ êµ¬ì„±**
- **EC2 ë°°í¬**, **Nginx + certbotìœ¼ë¡œ HTTPS** ì„¤ì •
- **Jenkins**ë¥¼ í†µí•œ **CI/CD êµ¬ì¶•**
- **AWS S3**ë¥¼ í†µí•œ íŒŒì¼ ì €ì¥
- **PostgreSQL (RDS)** ê¸°ë°˜ ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš©
- **JWT**ë¥¼ í†µí•œ ì¸ì¦ ë° **ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”** ì ìš©
> âš ï¸ **ì£¼ì˜**: `application-custom.properties` íŒŒì¼ì€ Gitì— í¬í•¨ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
> *ì§ì ‘ `src/main/resources` ê²½ë¡œì— ì•„ë˜ ë‚´ìš©ì„ í¬í•¨í•œ íŒŒì¼ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”:*

<details>
<summary><code>application-custom.properties</code> ì˜ˆì‹œ ë³´ê¸°</summary>

```bash
properties
spring.datasource.url=jdbc:postgresql://<DBì£¼ì†Œ>:5432/bidcast
spring.datasource.username=<DBìœ ì €>
spring.datasource.password=<DBë¹„ë°€ë²ˆí˜¸>

jwt.secret=<JWT ë¹„ë°€ í‚¤>
jwt.expiration=3600000

aws.s3.access-key=<AccessKey>
aws.s3.secret-key=<SecretKey>
aws.s3.region=ap-northeast-2
aws.s3.bucket=<ë²„í‚·ëª…>
aws.s3.folder=uploads
```
</details> 

---

### ğŸ›  ì‚¬ìš© ê¸°ìˆ  ìŠ¤íƒ

> ### 1. Server
> #### 1-1. App Server (ìœ ì € ì„œë¹„ìŠ¤)
> - **Build Tools**: `Vite`, `Gradle`
> - **Front-End**: `React`, `HTML`, `CSS`, `Thymeleaf`
> - **Back-End**: `Spring Boot`, `WebRTC`, `WebSocket`
> - **Persistence Layer**: `MyBatis`, `JPA`
> - **Authorization**: `JWT`, `Spring Security`
>
> #### 1-2. SFU Server (ì¤‘ê³„ ì„œë²„)
> - `Node.js`, `WebRTC`, `mediasoup`, `WebSocket`
>
> #### 1-3. Database
> - `Amazon RDS`, `PostgreSQL`
>
> #### 1-4. Cloud Storage
> - `Amazon S3`

> ### 2. Infrastructure
> - `Nginx`, `certbot`, `Let's Encrypt`

> ### 3. Dev Tools
> - `IntelliJ IDEA`, `Figma`

> ### 4. Collaboration
> - `Git`, `GitHub`

> ### 5. CI/CD
> - `Jenkins`


---

# ì„œë²„ ì½”ë“œë¶„ì„

## 1.WebSocket & WebRTC
<details>
<summary>ì ‘ê¸°/í¼ì¹˜ê¸°</summary>

### ì¢…ë¥˜

- **`socket`**  
  **í´ë¼ì´ì–¸íŠ¸ í•˜ë‚˜í•˜ë‚˜ì˜ ì—°ê²°**ì„ ë‚˜íƒ€ë‚´ëŠ” ê°ì²´
  í•´ë‹¹ í´ë¼ì´ì–¸íŠ¸ì™€ **1:1 í†µì‹ **í•˜ê±°ë‚˜ ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•  ë•Œ ì‚¬ìš©

- **`io`**  
  **ì „ì²´ ì†Œì¼“ ì„œë²„ ê°ì²´**ë¡œ, **ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ì— ë©”ì‹œì§€ë¥¼ ë³´ë‚´ê±°ë‚˜ íŠ¹ì • ë°©(room)ì— ë©”ì‹œì§€ë¥¼ ì „ë‹¬**í•  ë•Œ ì‚¬ìš©
  ì˜ˆ: `io.to(roomId).emit('event',data)`

- **`broadcast`**  
  **ìì‹ ì„ ì œì™¸í•œ ê°™ì€ ë°© ë˜ëŠ” ì „ì²´ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë©”ì‹œì§€ ì „ì†¡**
  ì˜ˆ: `socket.broadcast.emit()` â€” ìê¸° ìì‹ ì„ ì œì™¸í•œ ëª¨ë‘ì—ê²Œ ì „ì†¡

### ë°©ì‹

- **`on`**  
  í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° **ì´ë²¤íŠ¸ê°€ ì™”ì„ ë•Œ** ì‹¤í–‰í•  ì½œë°±ì„ ë“±ë¡  
  ì˜ˆ: `socket.on('produce', callback)`

- **`emit`**  
  **ì´ë²¤íŠ¸ì™€ ë°ì´í„°ë¥¼ ë³´ë‚´ëŠ” ë°©ì‹**  
  ì„œë²„ â†” í´ë¼ì´ì–¸íŠ¸ ì–‘ë°©í–¥ìœ¼ë¡œ ì‚¬ìš©
  ì˜ˆ: `socket.emit('new-producer', data)`

---

## WebRTC & mediasoup

### WebRTC

- **ì‹¤ì‹œê°„ ìŒì„±, ì˜ìƒ, ë°ì´í„° í†µì‹ ì„ ìœ„í•œ í‘œì¤€ ê¸°ìˆ **
- ë¸Œë¼ìš°ì € ë˜ëŠ” ë„¤ì´í‹°ë¸Œ ì•± ê°„ **P2P ì—°ê²°ì„ ì§€ì›**
- ì§ì ‘ ì—°ê²°ì´ ì–´ë ¤ìš´ ê²½ìš° **SFU ë°©ì‹** ì‚¬ìš© (Selective Forwarding Unit)

#### ICE, STUN, TURN

| ìš©ì–´   | ì„¤ëª… |
|--------|------|
| **ICE**  | ì—°ê²° ê°€ëŠ¥í•œ í›„ë³´ ì£¼ì†Œë“¤ì„ ìˆ˜ì§‘í•´ ìµœì  ê²½ë¡œë¥¼ ì„ íƒí•˜ëŠ” í”„ë ˆì„ì›Œí¬ |
| **STUN** | ê³µì¸ IP ë° í¬íŠ¸ ì •ë³´ë¥¼ ì•Œì•„ë‚´ê¸° ìœ„í•œ ì„œë²„ |
| **TURN** | P2P ì—°ê²°ì´ ë¶ˆê°€í•œ ê²½ìš° ë¯¸ë””ì–´ë¥¼ **ì¤‘ê³„**í•´ì£¼ëŠ” ì„œë²„ (ëŒ€ì—­í­ ì†Œëª¨ â†‘) |

### mediasoup

- **WebRTC SFU ì„œë²„ êµ¬í˜„ ë¼ì´ë¸ŒëŸ¬ë¦¬** 
- ë¯¸ë””ì–´ íë¦„ ì œì–´ë¥¼ ìœ„í•œ ê°ì²´ ê¸°ë°˜ êµ¬ì¡°

### mediasoup ì£¼ìš” ê°œë…

| ìš©ì–´       | ì„¤ëª… |
|------------|-----|
| **Worker**     | ë¯¸ë””ì–´ ì²˜ë¦¬ë¥¼ ë‹´ë‹¹í•˜ëŠ” **ë°±ê·¸ë¼ìš´ë“œ í”„ë¡œì„¸ìŠ¤** |
| **Router**     | í•œ ë°©(room)ì— í•˜ë‚˜ì”© ì¡´ì¬, **ë¯¸ë””ì–´ ê²½ë¡œ ì œì–´** ì—­í•  |
| **Transport**  | **í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ ê°„ ë¯¸ë””ì–´ ì—°ê²° í†µë¡œ** (DTLS/ICE ë“± í¬í•¨) |
| **Producer**   | í´ë¼ì´ì–¸íŠ¸ê°€ **ë¯¸ë””ì–´ë¥¼ ì†¡ì¶œí•  ë•Œ** ìƒì„±ë˜ëŠ” ê°ì²´ |
| **Consumer**   | í´ë¼ì´ì–¸íŠ¸ê°€ **ë¯¸ë””ì–´ë¥¼ ìˆ˜ì‹ í•  ë•Œ** ìƒì„±ë˜ëŠ” ê°ì²´ |

<details>
<summary>ìƒì„¸ ì„¤ëª…</summary>

- **Worker** : ë¯¸ë””ì–´ ì²˜ë¦¬ë¥¼ ë‹´ë‹¹í•˜ëŠ” **ì—”ì§„** ê°™ì€ í”„ë¡œì„¸ìŠ¤, ì‹¤ì œ ë¯¸ë””ì–´ ë°ì´í„°(ìŒì„±, ì˜ìƒ)ë¥¼ ë‹¤ë£¸ 
- **Router** : producerê°€ ë³´ë‚´ëŠ” ë¯¸ë””ì–´ ìŠ¤íŠ¸ë¦¼ì„ ë°›ì•„ì„œ ì–´ë–¤ consumerì—ê²Œ ë³´ë‚¼ì§€ ì •í•¨. í•˜ë‚˜ì˜ ë°©ì—ëŠ” í•˜ë‚˜ì˜ Routerê°€ ìˆìŒ
- **Transport** : ICE ì—°ê²°, DTLS í•¸ë“œì…°ì´í¬ ë“±ì„ í¬í•¨í•œ í†µì‹  ê²½ë¡œ, consumer/producer ê°ê° ì“°ëŠ” tranportê°€ ë‹¤ë¦„
</details>


## rtpCapabilities

- **WebRTC ì—°ê²° ì‹œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë¯¸ë””ì–´ í˜•ì‹ (ì½”ë±, í•´ìƒë„ ë“±) ëª©ë¡**
- ì†¡ì‹ ìì™€ ìˆ˜ì‹ ìì˜ **ë¯¸ë””ì–´ í˜¸í™˜ ì—¬ë¶€ë¥¼ íŒë‹¨**í•˜ê¸° ìœ„í•´ í•„ìˆ˜
- ì˜ˆì‹œ:
  ```
  {
    "codecs": [
      { "kind": "audio", "mimeType": "audio/opus", ... },
      { "kind": "video", "mimeType": "video/VP8", ... }
    ]
  }
  ```

## DTLS
- **UDP ê¸°ë°˜** í†µì‹ ì—ì„œ **ë³´ì•ˆ ì—°ê²°ì„ ìœ„í•œ SSL/TLS ê³„ì¸µ**
- WebRTCì—ì„œ **ë¯¸ë””ì–´ ë°ì´í„° ì•”í˜¸í™” ë° ì¸ì¦** ì—­í•  ìˆ˜í–‰

---

## ì„œë²„ ë¯¸ë””ì–´ ì²˜ë¦¬ íë¦„
<details>
<summary>ì ‘ê¸°/í¼ì¹˜ê¸°</summary>

### 1) rtpCapabilities ìš”ì²­

```
socket.on('create-router', (_, callback) => {
  callback({ rtpCapabilities: router.rtpCapabilities });
});
```

### 2) Transport ìƒì„±
<details>
<summary>create-transport ì½”ë“œ ë³´ê¸°</summary>

```bash
socket.on('create-transport', async ({ direction }, callback) => {
  const transport = await router.createWebRtcTransport({
    listenIps: [{ ip: '0.0.0.0', announcedIp: 'bidcastserver.kro.kr' }],
    enableUdp: true,
    enableTcp: true,
    preferUdp: true,
    portRange: { min: 40000, max: 40010 },
    iceServers: [
      { urls: 'stun:stun.l.google.com:19302' },
      { urls: 'turn:bidcastserver.kro.kr:3478', username: 'webrtc', credential: '1234' }
    ],
  });
  transports.set(transport.id, { transport, socketId: socket.id, direction });

  callback({
    id: transport.id,
    iceParameters: transport.iceParameters,
    iceCandidates: transport.iceCandidates,
    dtlsParameters: transport.dtlsParameters,
  });
});
```
</details>

### 3) Transport ì—°ê²° (DTLS í•¸ë“œì‰ì´í¬)
```
socket.on('connect-transport', async ({ dtlsParameters, transportId }, callback) => {
  const data = transports.get(transportId);
  if (!data) throw new Error('Transport not found');
  await data.transport.connect({ dtlsParameters });
  callback();
});
```

### 4) Producer ìƒì„± (ë¯¸ë””ì–´ ì†¡ì¶œ ì‹œì‘)
<details> 
<summary>produce ìš”ì²­ ì²˜ë¦¬</summary>

```
socket.on('produce', async ({ kind, rtpParameters, transportId, roomId }, callback) => {
  const data = transports.get(transportId);
  if (!data) throw new Error('Transport not found');
  const producer = await data.transport.produce({ kind, rtpParameters });

  if (!producers.has(roomId)) producers.set(roomId, new Map());
  producers.get(roomId).set(producer.id, { producer, socketId: socket.id, kind });

  socket.broadcast.to(roomId).emit('new-producer', {
    producerId: producer.id,
    socketId: socket.id,
    kind,
  });

  callback({ id: producer.id });
});
```
</details>

### 5) Consumer ìƒì„± (ë¯¸ë””ì–´ ìˆ˜ì‹  ìš”ì²­)
<details> <summary>consume ìš”ì²­ ì²˜ë¦¬</summary>

```
socket.on('consume', async ({ producerId, rtpCapabilities, transportId, roomId }, callback) => {
  const data = transports.get(transportId);
  if (!data) throw new Error('Transport not found');

  const roomProducers = producers.get(roomId);
  if (!roomProducers || !roomProducers.has(producerId)) throw new Error('Producer not found');

  if (!router.canConsume({ producerId, rtpCapabilities })) throw new Error('Cannot consume');

  const consumer = await data.transport.consume({
    producerId,
    rtpCapabilities,
    paused: false,
  });

  consumers.set(consumer.id, { consumer, socketId: socket.id });

  callback({
    id: consumer.id,
    producerId,
    kind: consumer.kind,
    rtpParameters: consumer.rtpParameters,
  });
});
```
</details>

### 6) Consumer ì¬ìƒ ì‹œì‘
```
socket.on('consumer-resume', async ({ consumerId }) => {
  const data = consumers.get(consumerId);
  if (!data) return;
  await data.consumer.resume();
});
```

### 7) ì—°ê²° ì¢…ë£Œ ì‹œ ìì› ì •ë¦¬
<details> <summary>disconnect ì²˜ë¦¬ ì „ì²´ ì½”ë“œ</summary>

```bash
socket.on('disconnect', () => {
  for (const [transportId, data] of transports) {
    if (data.socketId === socket.id) {
      data.transport.close();
      transports.delete(transportId);
    }
  }
  for (const [roomId, roomProducers] of producers) {
    for (const [producerId, data] of roomProducers) {
      if (data.socketId === socket.id) {
        data.producer.close();
        roomProducers.delete(producerId);
        io.emit('user-disconnected', {
          socketId: socket.id,
          producerId,
        });
      }
    }
    if (roomProducers.size === 0) producers.delete(roomId);
  }
  for (const [consumerId, data] of consumers) {
    if (data.socketId === socket.id) {
      data.consumer.close();
      consumers.delete(consumerId);
    }
  }
});
```
</details>

</details>

</details>


## 2. ì„œë²„ ì£¼ìš” ì „ì—­ ë³€ìˆ˜ ë° í•¨ìˆ˜ ì •ë¦¬

<details>
<summary>ì ‘ê¸°/í¼ì¹˜ê¸°</summary>

---

### 1. mediasoup ê´€ë ¨ ë³€ìˆ˜

- `transports` (Map)  
  transportIdë¥¼ keyë¡œ, `{ transport, socketId, direction }` ê°ì²´ë¥¼ valueë¡œ ì €ì¥  
  - mediasoup WebRTC ì—°ê²°ìš© Transport ê°ì²´ ê´€ë¦¬ìš©

- `producers` (Map)  
  roomIdë¥¼ keyë¡œ, valueëŠ” ë˜ ë‹¤ë¥¸ Map  
  ë‚´ë¶€ Map: producerIdë¥¼ keyë¡œ `{ producer, socketId, kind }`  
  - ê° ë°©(room)ë³„ ë¯¸ë””ì–´ ì†¡ì¶œì(Producer) ê°ì²´ ì €ì¥

- `consumers` (Map)  
  consumerIdë¥¼ keyë¡œ, `{ consumer, socketId }` ì €ì¥  
  - ë¯¸ë””ì–´ ìˆ˜ì‹ ì(Consumer) ê°ì²´ ê´€ë¦¬


### 2. ì†Œì¼“ & ë°© ê´€ë¦¬ ë³€ìˆ˜

- `socketRoomMap` (Map)  
  socketIdë¥¼ keyë¡œ, í˜„ì¬ ì‚¬ìš©ìê°€ ì…ì¥í•œ roomId ì €ì¥  
  - í•œ ì‚¬ìš©ìê°€ ì—¬ëŸ¬ ë°©ì— ë™ì‹œì— ì ‘ì†í•˜ì§€ ëª»í•˜ë„ë¡ ì œí•œí•˜ëŠ” ì—­í• 

- `socketIdMap` (Map)  
  loginIdë¥¼ keyë¡œ, ì†Œì¼“ ID ì €ì¥  
  - ë¡œê·¸ì¸ ìœ ì €ì™€ ì†Œì¼“ ì—°ê²° ê´€ë¦¬

- `auctionHostMap` (Map)  
  auctionIdë¥¼ keyë¡œ, í•´ë‹¹ ê²½ë§¤ì˜ í˜¸ìŠ¤íŠ¸ ì†Œì¼“ ID ì €ì¥  
  - ê²½ë§¤ë³„ í˜¸ìŠ¤íŠ¸ ì†Œì¼“ ê´€ë¦¬

- `auctionStates` (ê°ì²´)  
  auctionIdë¥¼ keyë¡œ, ê²½ë§¤ ì§„í–‰ ìƒíƒœ(ì„ íƒëœ ìƒí’ˆ ë“±) ì €ì¥  
  - ê²½ë§¤ ìƒíƒœ ë° ì§„í–‰ ì •ë³´ ê´€ë¦¬

- `auctionUserStatus` (ê°ì²´)  
  socketIdë¥¼ keyë¡œ, ì…ì°°ì ë‹‰ë„¤ì„, ë§ˆì§€ë§‰ ì…ì°°ê°€ ë“± ìƒíƒœ ì €ì¥  
  - ì…ì°°ì ê°œì¸ë³„ í˜„ì¬ ìƒíƒœ ì •ë³´ë¥¼ ì €ì¥


### 3. ìƒí’ˆ ë°ì´í„° ì •ê·œí™” í•¨ìˆ˜

```
function normalizeProduct(raw) {
  return {
    prodKey: raw.prod_key,
    aucKey: raw.auc_key,
    prodName: raw.prod_name,
    prodDetail: raw.prod_detail,
    unitValue: raw.unit_value,
    initPrice: raw.init_price,
    currentPrice: raw.current_price,
    finalPrice: raw.final_price,
    winnerId: raw.winner_id,
    prodStatus: raw.prod_status,
    fileUrl: raw.file_url
  };
}
```
</details>

## 3. í´ë¼ì´ì–¸íŠ¸-ì„œë²„ í†µì‹  íë¦„

<details>
<summary>ì ‘ê¸°/í¼ì¹˜ê¸°</summary>

### 1. ê²½ë§¤ì¥ ì…ì¥/í‡´ì¥

#### ì…ì¥
- ìš”ì²­: `join-room(roomId, userInfo)`
- ì‚¬ìš© ë³€ìˆ˜:
  - `socketRoomMap[socket.id] = roomId`
  - `socketIdMap[userInfo.loginId] = socket.id`
  - `auctionUserStatus[socket.id] = { nickname, lastBid: 0 }`
- ì‘ë‹µ:
  - ì…ì¥ì ëª©ë¡ ë°˜í™˜
  - ê¸°ì¡´ ìœ ì €ì—ê²Œ `user-status-update` ë¸Œë¡œë“œìºìŠ¤íŠ¸

#### í‡´ì¥
- ë°œìƒ: ì†Œì¼“ ì¢…ë£Œ ì‹œ ìë™
- ì²˜ë¦¬:
  - `transports`, `producers`, `consumers`ì—ì„œ socket ìì› ì œê±°
  - `socketRoomMap`, `socketIdMap`, `auctionUserStatus`ì—ì„œ ì œê±°
- ë¸Œë¡œë“œìºìŠ¤íŠ¸: `user-disconnected`


### 2. ì˜ìƒ ì†¡ì¶œ (mediasoup)

#### ë¯¸ë””ì–´ ìŠ¤íŠ¸ë¦¼ ìˆ˜ì‹  ë°œì†¡
- ìš”ì²­: `produce(kind, rtpParameters, transportId, roomId)`
- ì‚¬ìš© ë³€ìˆ˜:
  - `transports[transportId]` í™•ì¸
  - `producers[roomId][producerId] = { producer, socketId, kind }`
- ì‘ë‹µ: `producerId`
- ë¸Œë¡œë“œìºìŠ¤íŠ¸: `new-producer`

#### ê¸°ì¡´ Producer ë¦¬ìŠ¤íŠ¸ ìš”ì²­
- ìš”ì²­: `get-existing-producers(roomId)`
- ì‚¬ìš© ë³€ìˆ˜:
  - `producers` Map(roomId â†’ Map(producerId â†’ { producer, socketId, kind }))  
  - `auctionHostMap` (roomId â†’ hostSocketId)
- ì‘ë‹µ: ì½œë°±ìœ¼ë¡œ `{ existingProducers, hostSocketId }` ë°˜í™˜

#### Producer ì‚­ì œ
- ìš”ì²­: `close-producer(roomId)`
- ì‚¬ìš© ë³€ìˆ˜:
  - `producers` Mapì—ì„œ socket.idì— í•´ë‹¹í•˜ëŠ” Producer ê°ì²´ ì œê±° ë° close í˜¸ì¶œ
- ë¸Œë¡œë“œìºìŠ¤íŠ¸:
  - í•´ë‹¹ ê²½ë§¤ë°©ì— `user-disconnected` ì´ë²¤íŠ¸ (í•´ë‹¹ socketId, producerId) ì „ì†¡
- ì¶”ê°€:
  - ë°© ë‚´ Producerê°€ ì—†ìœ¼ë©´ `producers` Mapì—ì„œ í•´ë‹¹ roomId ì‚­ì œ

#### ë¯¸ë””ì–´ ìŠ¤íŠ¸ë¦¼ ìˆ˜ì‹  ìš”ì²­
- ìš”ì²­: `consume(producerId, rtpCapabilities, transportId, roomId)`
- ì‚¬ìš© ë³€ìˆ˜:
  - `transports[transportId]` í™•ì¸
  - `consumers[consumerId] = { consumer, socketId }`
- ì‘ë‹µ: `{ consumerId, producerId, kind, rtpParameters }`

#### ì¬ìƒì‹œì‘
- ìš”ì²­: `consumer-resume(consumerId)`
- ì²˜ë¦¬: `consumers[consumerId].consumer.resume()`


### 3. ì±„íŒ…

#### ì±„íŒ…
- ìš”ì²­: `chat-message(roomId, userId, message)`
- ì‚¬ìš© ë³€ìˆ˜:
  - `socketRoomMap[socket.id]` â†’ roomId ì¶”ì¶œ
- ë¸Œë¡œë“œìºìŠ¤íŠ¸: `chat-message`


### 4. ì…ì°°

#### ì…ì°°ì‹œë„
- ìš”ì²­: `bid-attempt(roomId, productId, bidAmount,userLoginId)`
- ì‚¬ìš© ë³€ìˆ˜:
  - `auctionStates[auctionId]` â†’ ì„ íƒëœ ìƒí’ˆ ìƒíƒœ ê°±ì‹   
  - `auctionUserStatus[auctionId][socket.id]` â†’ ì…ì°°ìë³„ ì…ì°° ê¸°ë¡ ì €ì¥  
  - `pool.query()` â†’ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ, ìƒí’ˆ ê°€ê²© ê°±ì‹ , ì…ì°° ê¸°ë¡ ì €ì¥
- ë¸Œë¡œë“œìºìŠ¤íŠ¸:
  - `user-status-update` â†’ ì…ì°°ì ìƒíƒœ ê°±ì‹  ì „ì²´ ì „ì†¡  
  - `bid-update` â†’ ì…ì°° ê²°ê³¼(ìƒí’ˆ, ì…ì°°ì ì •ë³´ í¬í•¨) ì „ì†¡  
  - `bid-rejected` â†’ ì…ì°° ì‹¤íŒ¨ ì‹œ ê°œë³„ ì‘ë‹µ


### 5. ê²½ë§¤ ê´€ë¦¬ (í˜¸ìŠ¤íŠ¸)

#### ìƒí’ˆ ì„ íƒ
- ìš”ì²­: `host-selected-product(auctionId, product)`
- ì‚¬ìš© ë³€ìˆ˜:
  - `auctionStates[auctionId].selectedProduct = product`
  - DB `product.prod_status = 'P'` ì—…ë°ì´íŠ¸
- ë¸Œë¡œë“œìºìŠ¤íŠ¸:
  - í•´ë‹¹ ê²½ë§¤ë°©ì— `host-selected-product` (ì„ íƒëœ ìƒí’ˆ ì •ë³´) ì „ì†¡

#### ë‚™ì°° / ìœ ì°° ìƒíƒœ ë³€ê²½
- ìš”ì²­: `bid-status(auctionId, prodKey, winner_id, status)`
- ì‚¬ìš© ë³€ìˆ˜:
  - DB `product.prod_status` ì—…ë°ì´íŠ¸ (`'C'` or `'F'`)
  - `auctionUserStatus[auctionId]`ì—ì„œ í•´ë‹¹ ìƒí’ˆ ì…ì°° ê¸°ë¡ ì‚­ì œ
- ë¸Œë¡œë“œìºìŠ¤íŠ¸:
  - í•´ë‹¹ ë°©ì— `bid-status` (ìƒí’ˆ ìƒíƒœ, ë‚™ì°°ì ì •ë³´) ì „ì†¡ (í˜¸ìŠ¤íŠ¸ ì œì™¸)
  - ì´í›„ `user-status-update` (ì „ì²´ ìœ ì € ìƒíƒœ ê°±ì‹ )

#### ìµœê³  ì…ì°°ì ë˜ëŒë¦¬ê¸°
- ìš”ì²­: `revert-bidder(auctionId, prodKey, winnerId, finalPrice)`
- ì‚¬ìš© ë³€ìˆ˜:
  - DB `product.final_price`, `winner_id` ì—…ë°ì´íŠ¸
  - `auctionStates[auctionId].selectedProduct` ì—…ë°ì´íŠ¸
  - DBì—ì„œ ë‚™ì°°ì ë‹‰ë„¤ì„ ì¡°íšŒ
- ë¸Œë¡œë“œìºìŠ¤íŠ¸:
  - í•´ë‹¹ ë°©ì— `bid-update` (ì—…ë°ì´íŠ¸ëœ ìƒí’ˆÂ·ë‚™ì°°ì ì •ë³´) ì „ì†¡

#### ì…ì°° ë‹¨ìœ„ ë³€ê²½
- ìš”ì²­: `change-bid-unit(roomId, newUnit)`
- ì‚¬ìš© ë³€ìˆ˜:
  - `auctionStates[roomId].selectedProduct.unitValue = newUnit`
- ë¸Œë¡œë“œìºìŠ¤íŠ¸: `bid-unit-changed`

#### ê²½ë§¤ ì¢…ë£Œ
- ìš”ì²­: `auction-end(auctionId)`
- ì‚¬ìš© ë³€ìˆ˜:
  - DB `auction` í…Œì´ë¸” status='ì¢…ë£Œ', end_time=NOW()ë¡œ ì—…ë°ì´íŠ¸
- ë¸Œë¡œë“œìºìŠ¤íŠ¸: `auction-ended`


### 6. ê¸°íƒ€

#### ì‹œì²­ì ìˆ˜ ì¡°íšŒ
- ìš”ì²­: `get-guest-counts(auctionIds[])`
- ì‚¬ìš© ë³€ìˆ˜:
  - `io.sockets.adapter.rooms` (ê° ê²½ë§¤ë°©(room) ì¸ì› ìˆ˜ ì¡°íšŒ)
- ì‘ë‹µ:
  - ì½œë°± í•¨ìˆ˜ë¡œ `{ auctionId: ì¸ì›ìˆ˜ }` ê°ì²´ ë°˜í™˜

</details>

---

# í´ë¼ì´ì–¸íŠ¸ ì½”ë“œë¶„ì„

## 1. ë¹Œë“œ ë° ë°°í¬ ê´€ë ¨ ì„¤ì •

- **Vite**ë¥¼ ì‚¬ìš©í•´ React ì•±ì„ **ë©€í‹° í˜ì´ì§€(entry)** êµ¬ì¡°ë¡œ ë¹Œë“œí•¨
- `vite.config.js`ì˜ `rollupOptions.input`ì— ê° ì§„ì… JSX íŒŒì¼ë“¤ì´ ì •ì˜ë˜ì–´ ìˆìœ¼ë©°, ë¹Œë“œì‹œ ê²°ê³¼ë¬¼ì€ `resources/static/bundle` ê²½ë¡œì— JS/CSS íŒŒì¼ë¡œ ì¶œë ¥ë¨.
- ê° í˜ì´ì§€ëŠ” Thymeleaf í…œí”Œë¦¿(.html)ì—ì„œ `${pageName}` ë³€ìˆ˜ë¥¼ í†µí•´ í•´ë‹¹ JS/CSSë¥¼ ë™ì ìœ¼ë¡œ ë¡œë“œí•˜ê³ , `<div id="root">`ì— React ì»´í¬ë„ŒíŠ¸ê°€ ë§ˆìš´íŠ¸ë¨. â†’ SPAê°€ ì•„ë‹Œ **ë©€í‹° í˜ì´ì§€ ê¸°ë°˜ êµ¬ì¡°**ì„.
- 
- ì •ì  ë¦¬ì†ŒìŠ¤ëŠ” **Spring Boot**ì—ì„œ ì„œë¹™í•˜ë©°, HTTPS ë° í”„ë¡ì‹œëŠ” **Nginx + Certbot**ì„ í†µí•´ ì²˜ë¦¬í•¨.
- `vite.config.js`ì˜ `server.https` ì„¤ì •ì€ **ë¡œì»¬ ê°œë°œìš©(í…ŒìŠ¤íŠ¸ìš© HTTPS)**ì´ë©°, ë°°í¬ í™˜ê²½ì—ì„œëŠ” ì‚¬ìš©ë˜ì§€ ì•ŠìŒ.
- Jenkinsë¥¼ í†µí•œ ìë™ ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ ë° EC2/Nginx ì„¤ì • ë“± ì¸í”„ë¼ ê´€ë ¨ ë‚´ìš©ì€ [AWSì„¸íŒ….md](./AWSì„¸íŒ….md) ë¬¸ì„œì— ë³„ë„ë¡œ ì •ë¦¬ë˜ì–´ ìˆìŒ.

<details>
<summary><strong>vite.config.js ì£¼ìš” ì„¤ì •</strong></summary>

```js
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import fs from 'fs';
import path from 'path';

export default defineConfig({
  plugins: [react()],
  root: 'src/main/react',
  build: {
    outDir: '../resources/static/bundle',
    emptyOutDir: true,
    cssCodeSplit: true,
    rollupOptions: {
      input: {
        home: path.resolve(__dirname, 'src/home/home.jsx'),
        login: path.resolve(__dirname, 'src/auth/login/login.jsx'),
        bidGuest: path.resolve(__dirname, 'src/bidGuest/bidGuest.jsx'),
        // ... ìƒëµ ê°€ëŠ¥
      },
      output: {
        entryFileNames: 'js/[name].bundle.js',
        chunkFileNames: 'chunk/[name].chunk.js',
        assetFileNames: `css/[name].css`,
      },
    },
  },
  server: {
    https: {
      key: fs.readFileSync('certs/key.pem'),
      cert: fs.readFileSync('certs/cert.pem'),
    },
    host: '0.0.0.0',
    port: 3200,
  },
});
```
</details>

<details>
  <summary><strong>Thymeleaf í…œí”Œë¦¿ ì˜ˆì‹œ</strong></summary>

```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>[[${pageName}]]</title>
  <link rel="stylesheet" th:href="@{'/bundle/css/' + ${pageName} + '.css'}" onerror="this.remove()" />
</head>
<body>
  <div id="root"></div>
  <script type="module" th:src="@{'/bundle/js/' + ${pageName} + '.bundle.js'}"></script>
</body>
</html>
```
</details>

<details>
  <summary><strong>Spring Boot Controller â€” ë©€í‹° í˜ì´ì§€ ë§¤í•‘</strong></summary>

```java
package com.project.bidcast.controller;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;

import javax.servlet.http.HttpSession;

@Controller
public class MainController {

    @GetMapping("/")
    public String redirectToHome() {
        return "redirect:/home.do";
    }

    @GetMapping("/{pageName}.do") // ëª¨ë“  í˜ì´ì§€ ìš”ì²­ì„ ì²˜ë¦¬
    public String page(HttpSession session , @PathVariable String pageName, Model model) {
        model.addAttribute("pageName", pageName); // Thymeleafì— pageName ì „ë‹¬
        System.out.println("ë·°ì´ë¦„:" + pageName);

        if(session.getAttribute("id") != null) 
            System.out.println(session.getAttribute("id"));

        return "view"; // í•­ìƒ ë™ì¼í•œ view.html í…œí”Œë¦¿ìœ¼ë¡œ ì´ë™
    }
}
```
</details>

<details>
  <summary><strong>ğŸ“„ vite.config.jsì˜ ë¡œì»¬ ê°œë°œìš© HTTPS ì„¤ì • (ë°°í¬ ì‹œ ë¯¸ì‚¬ìš©)</strong></summary>
```js
server: {
  https: {
    key: fs.readFileSync('certs/key.pem'),
    cert: fs.readFileSync('certs/cert.pem'),
  },
  host: '0.0.0.0',
  port: 3200,
}
```
</details>

## 2. WebSocket & WebRTC

### 1.1 Host (í˜¸ìŠ¤íŠ¸) ì¸¡ êµ¬í˜„

- í˜¸ìŠ¤íŠ¸ ì¸¡ì€ ê²½ë§¤ ë°©ì†¡ì„ ì†¡ì¶œí•˜ê³  ì°¸ê°€ìë“¤ì˜ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” í•µì‹¬ ì—­í• ì„ ìˆ˜í–‰
- WebSocketê³¼ WebRTCë¥¼ í†µí•´ ì‹¤ì‹œê°„ ì˜ìƒ ì†¡ì¶œê³¼ ì…ì°° ì •ë³´ êµí™˜ì´ ì´ë£¨ì–´ì§

#### 1.1.1 ì£¼ìš” ë³€ìˆ˜ ë° ìƒíƒœ

| ë³€ìˆ˜ëª…           | ì„¤ëª…                                         |
|------------------|----------------------------------------------|
| `peers`          | ì „ì²´ ì°¸ê°€ìì˜ ì†Œì¼“ IDë¥¼ í‚¤ë¡œ í•˜ëŠ” ê°ì²´<br>ì˜ˆ: `{ socketId: { stream } }` |
| `hostSocketId`   | í˜¸ìŠ¤íŠ¸(ë°©ì†¡ ì†¡ì¶œì)ì˜ ì†Œì¼“ ID                 |
| `mySocketId`     | í˜„ì¬ í´ë¼ì´ì–¸íŠ¸(í˜¸ìŠ¤íŠ¸)ì˜ ì†Œì¼“ ID              |
| `userInfoMap`    | ì°¸ê°€ìë³„ ë‹‰ë„¤ì„, ì…ì°°ê°€ ë“±ì´ ì €ì¥ëœ ê°ì²´        |
| `selectedProductIdx` | í˜„ì¬ ê²½ë§¤ ì¤‘ì¸ ìƒí’ˆì˜ ì¸ë±ìŠ¤                   |
| `products`       | ê²½ë§¤ ìƒí’ˆ ë¦¬ìŠ¤íŠ¸ ë°°ì—´                           |
| `prevHighestBidder` | ì´ì „ ìµœê³  ì…ì°°ì ì •ë³´ (ì¬ì…ì°° ë°˜ì˜ ì‹œ ì‚¬ìš©)      |

#### 1.1.2 ì£¼ìš” WebSocket ì´ë²¤íŠ¸ ë° ìš”ì²­

| ì´ë²¤íŠ¸ëª…               | ëª©ì  ë° ì„¤ëª…                                               | ë°œì‹ ì  | ìˆ˜ì‹ ì       |
|------------------------|-----------------------------------------------------------|---------|--------------|
| `host-selected-product` | í˜¸ìŠ¤íŠ¸ê°€ íŠ¹ì • ê²½ë§¤ ìƒí’ˆì„ ì„ íƒí–ˆìŒì„ ì„œë²„ì— ì•Œë¦¼          | í˜¸ìŠ¤íŠ¸  | ì„œë²„, í´ë¼ì´ì–¸íŠ¸ |
| `bid-status`            | ë‚™ì°°(ì™„ë£Œ), ìœ ì°°(ì‹¤íŒ¨) ìƒíƒœë¥¼ ì„œë²„ì— ì „ë‹¬                  | í˜¸ìŠ¤íŠ¸  | ì„œë²„, í´ë¼ì´ì–¸íŠ¸ |
| `revert-bidder`         | ìµœê³  ì…ì°°ìë¥¼ ì´ì „ ì…ì°°ìë¡œ ë˜ëŒë¦´ ë•Œ ì„œë²„ì— ìš”ì²­           | í˜¸ìŠ¤íŠ¸  | ì„œë²„, í´ë¼ì´ì–¸íŠ¸ |

#### 1.1.3 WebRTC ë¯¸ë””ì–´ ìŠ¤íŠ¸ë¦¼ ê´€ë¦¬

- **MediaStream ì†¡ì¶œ**: í˜¸ìŠ¤íŠ¸ëŠ” ìì‹ ì˜ ì¹´ë©”ë¼/ë§ˆì´í¬ ìŠ¤íŠ¸ë¦¼ì„ `peers[hostSocketId].stream` í˜•íƒœë¡œ ê´€ë¦¬í•˜ë©°, ì´ë¥¼ ë©”ì¸ ë¹„ë””ì˜¤ ì»´í¬ë„ŒíŠ¸(`MainVideo.jsx`)ì— ì „ë‹¬í•´ ì†¡ì¶œí•¨
- **ì°¸ê°€ì ìŠ¤íŠ¸ë¦¼ ìˆ˜ì‹ **: í˜¸ìŠ¤íŠ¸ëŠ” ì°¸ê°€ìë“¤ì˜ ìŠ¤íŠ¸ë¦¼ë„ `peers` ê°ì²´ë¥¼ í†µí•´ ìˆ˜ì‹ , `VideoGrid.jsx`ë¥¼ í†µí•´ í™”ë©´ì— í‘œì‹œ
- **ìŒì†Œê±° ë° ë³¼ë¥¨ ì œì–´**: ê° ë¹„ë””ì˜¤ ìŠ¤íŠ¸ë¦¼ì— ëŒ€í•´ ìŒì†Œê±°, ë³¼ë¥¨ ì¡°ì ˆ ê¸°ëŠ¥ì´ êµ¬í˜„ë˜ì–´ ìˆìœ¼ë©° ë§í•˜ëŠ” ì‚¬ëŒ ê°ì§€ë„ ê°€ëŠ¥

--- 

### 1.2 Client (ê²ŒìŠ¤íŠ¸) ì¸¡ êµ¬í˜„

#### 1.2.1 ì£¼ìš” ë³€ìˆ˜ ë° ìƒíƒœ

| ë³€ìˆ˜ëª…              | ì„¤ëª…                                                  |
|---------------------|-------------------------------------------------------|
| `peers`             | ì „ì²´ ì°¸ê°€ìì˜ ì†Œì¼“ IDë¥¼ í‚¤ë¡œ í•˜ëŠ” ê°ì²´<br>ì˜ˆ: `{ socketId: { stream } }` |
| `hostSocketId`      | í˜¸ìŠ¤íŠ¸ ì†Œì¼“ ID                                        |
| `mySocketId`        | í˜„ì¬ í´ë¼ì´ì–¸íŠ¸(ê²ŒìŠ¤íŠ¸)ì˜ ì†Œì¼“ ID                     |
| `userInfoMap`       | ì°¸ê°€ìë³„ ë‹‰ë„¤ì„, ì…ì°°ê°€ ë“±ì´ ì €ì¥ëœ ê°ì²´               |
| `product`           | í˜„ì¬ ê²½ë§¤ ì¤‘ì¸ ìƒí’ˆ ì •ë³´                               |

#### 1.2.2 ì£¼ìš” WebSocket ì´ë²¤íŠ¸ ë° ìš”ì²­

| ì´ë²¤íŠ¸ëª…           | ëª©ì  ë° ì„¤ëª…                                         | ë°œì‹ ì  | ìˆ˜ì‹ ì            |
|--------------------|-----------------------------------------------------|---------|-------------------|
| `bid-attempt`      | ì…ì°° ì‹œë„ ìš”ì²­                                       | ê²ŒìŠ¤íŠ¸  | ì„œë²„, í´ë¼ì´ì–¸íŠ¸  |
| `bid-update`       | ì…ì°°ê°€ ë³€ê²½ ì•Œë¦¼                                     | ì„œë²„    | ëª¨ë“  í´ë¼ì´ì–¸íŠ¸   |
| `host-selected-product` | í˜¸ìŠ¤íŠ¸ê°€ ìƒí’ˆì„ ì„ íƒí–ˆìŒì„ ì•Œë¦¼                   | ì„œë²„    | í´ë¼ì´ì–¸íŠ¸ ì „ì›   |
| `bid-status`       | ë‚™ì°°, ìœ ì°° ìƒíƒœ ì—…ë°ì´íŠ¸                             | ì„œë²„    | í´ë¼ì´ì–¸íŠ¸ ì „ì›   |

#### 1.2.3 WebRTC ë¯¸ë””ì–´ ìŠ¤íŠ¸ë¦¼ ê´€ë¦¬

- ê²ŒìŠ¤íŠ¸ëŠ” ìì‹ ì˜ ì¹´ë©”ë¼/ë§ˆì´í¬ ìŠ¤íŠ¸ë¦¼ì„ `peers[mySocketId].stream` ìœ¼ë¡œ ê´€ë¦¬
- í˜¸ìŠ¤íŠ¸ ë° ë‹¤ë¥¸ ì°¸ê°€ìë“¤ì˜ ìŠ¤íŠ¸ë¦¼ì€ `peers` ê°ì²´ë¥¼ í†µí•´ ë°›ì•„ `VideoGrid` ì»´í¬ë„ŒíŠ¸ì— í‘œì‹œ
- ìŒì†Œê±°, ë³¼ë¥¨ ì¡°ì ˆ ê¸°ëŠ¥ì´ ê° ë¹„ë””ì˜¤ ìŠ¤íŠ¸ë¦¼ë³„ë¡œ ì¡´ì¬í•˜ë©°, ìŒì„± ë°œí™” ìƒíƒœë„ ê°ì§€ ê°€ëŠ¥

## 3. í´ë¼ì´ì–¸íŠ¸ - ì„œë²„ í†µì‹  íë¦„

| ê¸°ëŠ¥               | ì‹œì‘ ì£¼ì²´    | ì´ë²¤íŠ¸ ì´ë¦„              | ì„œë²„ ì²˜ë¦¬ ë‚´ìš©                         | í´ë¼ì´ì–¸íŠ¸ ì²˜ë¦¬ ë‚´ìš©                  |
|--------------------|--------------|-------------------------|--------------------------------------|-------------------------------------|
| ì…ì°° ì‹œë„          | ê²ŒìŠ¤íŠ¸       | `bid-attempt`           | ì…ì°°ê°€ ìœ íš¨ì„± ê²€ì‚¬ ë° ìµœê³  ì…ì°°ì ê°±ì‹  í›„ `bid-update` ë°©ì†¡ | `bid-update` ìˆ˜ì‹  í›„ UI ë° ìƒíƒœ ê°±ì‹  |
| ê²½ë§¤ ìƒí’ˆ ì„ íƒ     | í˜¸ìŠ¤íŠ¸       | `host-selected-product` | ìƒí’ˆ ë³€ê²½ ì €ì¥ ë° ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ì— ë°©ì†¡ | ìƒí’ˆ ì •ë³´ ê°±ì‹  ë° UI ë³€ê²½            |
| ë‚™ì°°/ìœ ì°° ìƒíƒœ ë³€ê²½| í˜¸ìŠ¤íŠ¸       | `bid-status`             | ê²½ë§¤ ìƒíƒœ ì €ì¥ ë° ë°©ì†¡                | ìƒíƒœ ë©”ì‹œì§€ ë° UI ê°±ì‹                |
| ìµœê³  ì…ì°°ì ë˜ëŒë¦¬ê¸°| í˜¸ìŠ¤íŠ¸      | `revert-bidder`          | ìµœê³  ì…ì°°ì ì •ë³´ ì¬ì„¤ì • ë° ë°©ì†¡      | ì…ì°°ì ì •ë³´ ì¬ê°±ì‹                    |
| WebRTC ë¯¸ë””ì–´ ì†¡ì¶œ | í˜¸ìŠ¤íŠ¸/ê²ŒìŠ¤íŠ¸| WebRTC ì‹œê·¸ë„ë§          | SFU ì—­í• ë¡œ ë¯¸ë””ì–´ ìŠ¤íŠ¸ë¦¼ ì¤‘ê³„        | ìŠ¤íŠ¸ë¦¼ ìƒì„± ë° ìˆ˜ì‹ , ë¹„ë””ì˜¤ ì»´í¬ë„ŒíŠ¸ì— ì¶œë ¥ |
| ì‹¤ì‹œê°„ ì±„íŒ…        | í˜¸ìŠ¤íŠ¸/ê²ŒìŠ¤íŠ¸| `chat-message`     | ë©”ì‹œì§€ ì¤‘ê³„ ë° ë¸Œë¡œë“œìºìŠ¤íŠ¸           | ë©”ì‹œì§€ ìˆ˜ì‹  ë° UI ì—…ë°ì´íŠ¸           |

## 4. ì¸ì¦ ë° ê¶Œí•œ ê´€ë¦¬ íë¦„ (Spring Security ê´€ë ¨ í¬í•¨)

### 4.1 ì£¼ìš” ê¸°ëŠ¥ ê°œìš”

- **ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”**: `BCryptPasswordEncoder`ë¥¼ ì‚¬ìš©í•´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•ˆì „í•˜ê²Œ ì•”í˜¸í™”
- **CSRF ë¹„í™œì„±í™”**: API ì„œë²„ í™˜ê²½ì— ë§ê²Œ CSRF ë³´í˜¸ëŠ” ë¹„í™œì„±í™” ìƒíƒœ
- **ì ‘ê·¼ ê¶Œí•œ ì„¤ì •**:
  - íŠ¹ì • ê²½ë¡œ(`/css/**`, `/js/**`, `/img/**`, `/home.do`, `/login.do` ë“±)ëŠ” ì¸ì¦ ì—†ì´ ì ‘ê·¼ í—ˆìš©
  - ë‚˜ë¨¸ì§€ ê²½ë¡œëŠ” ì¸ì¦ í•„ìš”
- **ì„¸ì…˜ ê´€ë¦¬**: í•„ìš” ì‹œì—ë§Œ ì„¸ì…˜ ìƒì„± (`SessionCreationPolicy.IF_REQUIRED`)
- **ì¸ì¦ ì‹¤íŒ¨ ì²˜ë¦¬**: ì¸ì¦ì´ í•„ìš”í•œ ìš”ì²­ì— ì¸ì¦ë˜ì§€ ì•Šì€ ê²½ìš° `/login.do` í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
- **ë¡œê·¸ì¸ ì„¤ì •**:
  - ë¡œê·¸ì¸ í˜ì´ì§€ëŠ” `/login.do`
  - ë¡œê·¸ì¸ ì²˜ë¦¬ URLì€ `/login`
  - ë¡œê·¸ì¸ ì„±ê³µ ì‹œ `/home.do`ë¡œ ì´ë™
  - ë¡œê·¸ì¸ ì‹¤íŒ¨ ì‹œ HTTP 401 Unauthorized ìƒíƒœ ë°˜í™˜
- **ë¡œê·¸ì•„ì›ƒ ì„¤ì •**:
  - ë¡œê·¸ì•„ì›ƒ URLì€ `/logout`
  - ë¡œê·¸ì•„ì›ƒ ì„±ê³µ ì‹œ `/home.do`ë¡œ ì´ë™
  - ì„¸ì…˜ ë¬´íš¨í™” ë° `JSESSIONID` ì¿ í‚¤ ì‚­ì œ

---

### 4.2 ì„¤ì • ì£¼ìš” ì½”ë“œ ì„¤ëª…

| ì„¤ì • í•­ëª©            | ë‚´ìš© ë° ì—­í•                                          |
|---------------------|-----------------------------------------------------|
| `passwordEncoder()` | ë¹„ë°€ë²ˆí˜¸ë¥¼ BCrypt ë°©ì‹ìœ¼ë¡œ ì•”í˜¸í™”                      |
| `csrf().disable()`  | CSRF ê³µê²© ë°©ì–´ ê¸°ëŠ¥ ë¹„í™œì„±í™” (API í™˜ê²½ì— ì í•©)          |
| `authorizeHttpRequests()` | ì¸ì¦ ì—†ì´ ì ‘ê·¼ ê°€ëŠ¥í•œ URL ê²½ë¡œ ì§€ì •                    |
| `.anyRequest().authenticated()` | ë‚˜ë¨¸ì§€ ëª¨ë“  ìš”ì²­ì€ ì¸ì¦ í•„ìš”                            |
| `sessionManagement()` | ì„¸ì…˜ ìƒì„± ì •ì±… ì„¤ì • (`IF_REQUIRED`: í•„ìš”ì‹œë§Œ ìƒì„±)     |
| `exceptionHandling()` | ì¸ì¦ ì‹¤íŒ¨ ì‹œ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì²˜ë¦¬             |
| `formLogin()`       | ë¡œê·¸ì¸ í˜ì´ì§€, ì²˜ë¦¬ URL, ì„±ê³µ ë° ì‹¤íŒ¨ í•¸ë“¤ëŸ¬ ì„¤ì •       |
| `logout()`          | ë¡œê·¸ì•„ì›ƒ URL, ì„±ê³µ í›„ ì´ë™ í˜ì´ì§€, ì„¸ì…˜ ë¬´íš¨í™”, ì¿ í‚¤ ì‚­ì œ |